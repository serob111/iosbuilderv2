<!Doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tic Tac Toe — Single File</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;--win:#16a34a}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{display:flex;align-items:center;justify-content:center;padding:24px;background:linear-gradient(180deg,#071027 0%,#081425 100%);color:#e6eef6}
    .wrap{width:min(540px,96%);background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:20px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    h1{margin:0 0 8px;font-size:20px;letter-spacing:0.2px}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:14px}
    .btn, .toggle{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:var(--muted);cursor:pointer}
    .btn:hover,.toggle:hover{border-color:rgba(255,255,255,0.12);color:#fff}
    .toggle.active{background:linear-gradient(90deg,var(--accent),#7c3aed);border:none;color:white}
    .status{margin-left:auto;color:var(--muted);font-size:14px}
    .board{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border-radius:10px}
    .cell{aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;font-size:48px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border-radius:8px;cursor:pointer;user-select:none;transition:transform .08s ease,box-shadow .12s ease;border:1px solid rgba(255,255,255,0.04)}
    .cell:active{transform:scale(.98)}
    .cell.disabled{cursor:not-allowed;opacity:0.9}
    .cell.x{color:#ff7ab6}
    .cell.o{color:#62d0ff}
    .cell.win{background:linear-gradient(90deg,rgba(22,163,74,0.12),rgba(6,182,212,0.06));box-shadow:0 6px 18px rgba(2,6,23,0.5)}
    .footer{display:flex;gap:10px;align-items:center;margin-top:12px}
    .score{display:flex;gap:8px;align-items:center;font-size:14px;color:var(--muted)}
    .kbd{background:rgba(255,255,255,0.03);padding:4px 8px;border-radius:6px;font-size:12px}
    @media (max-width:420px){.cell{font-size:36px}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Tic Tac Toe — Single file</h1>
    <div class="controls">
      <button id="btn-new" class="btn">New round</button>
      <button id="btn-reset" class="btn">Reset scores</button>
      <button id="mode-2p" class="toggle active">2 Players</button>
      <button id="mode-cpu" class="toggle">Play vs CPU</button>
      <div class="status" id="status">Turn: X</div>
    </div>

    <div class="board" id="board" aria-label="Tic Tac Toe board" role="grid">
      <!-- cells generated by JS -->
    </div>

    <div class="footer">
      <div class="score">X: <strong id="score-x">0</strong></div>
      <div class="score">O: <strong id="score-o">0</strong></div>
      <div class="score">Draws: <strong id="score-d">0</strong></div>
      <div style="margin-left:auto;color:var(--muted);font-size:13px">Tips: <span class="kbd">N</span> = new round • Click cell or press 1–9</div>
    </div>
  </div>

  <script>
    // Game state
    const boardEl = document.getElementById('board');
    const statusEl = document.getElementById('status');
    const btnNew = document.getElementById('btn-new');
    const btnReset = document.getElementById('btn-reset');
    const mode2p = document.getElementById('mode-2p');
    const modeCpu = document.getElementById('mode-cpu');
    const scoreX = document.getElementById('score-x');
    const scoreO = document.getElementById('score-o');
    const scoreD = document.getElementById('score-d');

    let cells = []; // 'X' | 'O' | null
    let current = 'X';
    let playing = true;
    let scores = {X:0,O:0,D:0};
    let vsCpu = false;

    const wins = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    function init(){
      boardEl.innerHTML = '';
      cells = Array(9).fill(null);
      for(let i=0;i<9;i++){
        const el = document.createElement('button');
        el.className='cell';
        el.setAttribute('data-i',i);
        el.setAttribute('role','gridcell');
        el.setAttribute('aria-label',`cell ${i+1}`);
        el.addEventListener('click',onClickCell);
        boardEl.appendChild(el);
      }
      current = 'X';
      playing = true;
      updateStatus();
    }

    function updateStatus(msg){
      if(msg){ statusEl.textContent = msg; return }
      statusEl.textContent = playing ? `Turn: ${current}` : 'Round over';
    }

    function onClickCell(e){
      const i = Number(e.currentTarget.dataset.i);
      if(!playing || cells[i]) return;
      makeMove(i, current);
      if(vsCpu && playing) {
        // CPU is O by default; if current was X and we played, now CPU moves
        if(current === 'O' || current === 'X'){
          // after player move, CPU (O) moves
          setTimeout(()=>{
            const cpuMove = bestMove(cells, 'O');
            if(cpuMove !== null) makeMove(cpuMove, 'O');
          }, 250);
        }
      }
    }

    function makeMove(i, player){
      cells[i] = player;
      const el = boardEl.querySelector(`[data-i='${i}']`);
      el.textContent = player;
      el.classList.add(player.toLowerCase());
      el.classList.add('disabled');

      const winInfo = checkWin(cells);
      if(winInfo.winner){
        playing = false;
        highlightWin(winInfo.line);
        scores[winInfo.winner]++;
        updateScores();
        updateStatus(`${winInfo.winner} wins!`);
        return;
      }
      if(cells.every(c=>c!==null)){
        playing = false;
        scores.D++;
        updateScores();
        updateStatus('Draw');
        return;
      }
      // swap current
      current = player === 'X' ? 'O' : 'X';
      // if vsCpu and CPU starts as X (not default) handle elsewhere
      updateStatus();
    }

    function highlightWin(line){
      line.forEach(i=>{
        const el = boardEl.querySelector(`[data-i='${i}']`);
        if(el) el.classList.add('win');
      });
    }

    function checkWin(b){
      for(const line of wins){
        const [a,b1,c] = line;
        if(b[a] && b[a] === b[b1] && b[a] === b[c]){
          return {winner:b[a], line};
        }
      }
      return {winner:null};
    }

    function updateScores(){
      scoreX.textContent = scores.X;
      scoreO.textContent = scores.O;
      scoreD.textContent = scores.D;
    }

    btnNew.addEventListener('click', ()=>init());
    btnReset.addEventListener('click', ()=>{scores={X:0,O:0,D:0};updateScores();init();});

    mode2p.addEventListener('click', ()=>{
      vsCpu = false; mode2p.classList.add('active'); modeCpu.classList.remove('active'); init();
    });
    modeCpu.addEventListener('click', ()=>{
      vsCpu = true; modeCpu.classList.add('active'); mode2p.classList.remove('active'); init();
    });

    // Keyboard support: 1..9 keys map to cells
    document.addEventListener('keydown',(e)=>{
      if(e.key === 'n' || e.key === 'N') { init(); return }
      if(!playing) return;
      if(e.key >= '1' && e.key <= '9'){
        const idx = Number(e.key) - 1;
        const cellBtn = boardEl.querySelector(`[data-i='${idx}']`);
        if(cellBtn) cellBtn.click();
      }
    });

    // --- Simple Minimax implementation for small board ---
    function bestMove(boardState, player){
      // if no moves left
      const avail = boardState.map((v,i)=>v===null?i:null).filter(v=>v!==null);
      if(avail.length === 0) return null;
      // if easy: choose center if available, else random — but we use minimax for optimal play
      const opponent = player === 'X' ? 'O' : 'X';

      function scoreFor(winner){
        if(winner === player) return 10;
        if(winner === opponent) return -10;
        return 0;
      }

      function minimax(state, turn){
        const check = checkWin(state);
        if(check.winner !== null) return scoreFor(check.winner);
        if(state.every(s=>s!==null)) return 0;

        const moves = [];
        for(let i=0;i<9;i++){
          if(state[i]===null){
            const copy = state.slice();
            copy[i] = turn;
            const val = minimax(copy, turn === 'X' ? 'O' : 'X');
            moves.push({i, val});
          }
        }
        if(turn === player){
          // maximize
          let best = -Infinity;
          for(const m of moves) if(m.val > best) best = m.val;
          return best;
        } else {
          // minimize
          let best = Infinity;
          for(const m of moves) if(m.val < best) best = m.val;
          return best;
        }
      }

      // choose move with best minimax value
      let bestVal = -Infinity;
      let bestIdx = null;
      for(const i of avail){
        const copy = boardState.slice();
        copy[i] = player;
        const val = minimax(copy, opponent);
        if(val > bestVal){ bestVal = val; bestIdx = i }
      }
      return bestIdx;
    }

    // If vsCpu and CPU is set to start as X, you can adjust. By default player X is human.

    // initialize
    init();
  </script>
</body>
</html>